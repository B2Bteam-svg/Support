<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Almosafer B2B - Professional Support Tool</title>
    <style>
        :root {
            --primary-blue: #002855;
            --almosafer-green: #00c4a7;
            --bg-light: #f4f7fa;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-main: #1e293b;
            --hover-bg: #edfcf7;
        }

        body { 
            font-family: 'Segoe UI', Roboto, -apple-system, sans-serif; 
            background-color: var(--bg-light); 
            margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; color: var(--text-main);
        }

        .header { 
            width: 100%; background: linear-gradient(135deg, var(--primary-blue) 0%, #004080 100%); 
            padding: 25px 0; text-align: center; color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        }
        .header img { width: 180px; height: auto; margin-bottom: 10px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }
        .header h1 { margin: 0; font-size: 24px; font-weight: 700; letter-spacing: 1px; }

        .container { 
            width: 95%; max-width: 1050px; background: var(--card-bg); margin-top: 30px; padding: 35px; border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.05); margin-bottom: 40px; border: 1px solid rgba(0,0,0,0.05);
        }

        .tabs { display: flex; border-bottom: 2px solid #edf2f7; margin-bottom: 30px; gap: 8px; overflow-x: auto; padding-bottom: 2px; }
        .tab-item { 
            padding: 12px 24px; cursor: pointer; font-weight: 700; color: #718096; border-radius: 12px 12px 0 0;
            transition: all 0.3s ease; font-size: 15px; white-space: nowrap; border-bottom: 3px solid transparent;
        }
        .tab-item:hover { color: var(--almosafer-green); background: #f8fafc; }
        .tab-item.active { 
            color: var(--primary-blue); border-bottom: 3px solid var(--almosafer-green); background: var(--hover-bg); 
        }

        .section { display: none; }
        .section.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .form-group { margin-bottom: 25px; text-align: right; }
        label { display: block; margin-bottom: 12px; font-weight: 700; color: var(--primary-blue); font-size: 16px; }
        
        .trip-instruction {
            display: block; background: #f0f9ff; border-right: 4px solid #007bff; padding: 10px; margin-bottom: 15px;
            font-size: 14px; color: #004085; line-height: 1.5; text-align: left; direction: ltr;
        }

        input, textarea { 
            width: 100%; padding: 14px; border: 2px solid var(--border-color); border-radius: 12px; font-size: 15px; 
            box-sizing: border-box; transition: all 0.3s ease; outline: none;
        }
        input:focus, textarea:focus { border-color: var(--almosafer-green); box-shadow: 0 0 0 4px rgba(0, 196, 167, 0.1); }

        .scenario-grid { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; margin: 20px 0; direction: ltr;
        }

        .scenario-option { 
            display: flex; align-items: center; padding: 10px 14px; background: #ffffff; border: 2px solid #f1f5f9; 
            border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; color: #475569;
            transition: all 0.25s ease; position: relative; overflow: hidden;
        }
        .scenario-option:hover { 
            border-color: var(--almosafer-green); background: var(--hover-bg); transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 196, 167, 0.1);
        }
        .scenario-option input { margin-right: 12px; accent-color: var(--almosafer-green); width: 18px; height: 18px; cursor: pointer; }
        
        .scenario-option:has(input:checked) { 
            border-color: var(--almosafer-green); background: var(--hover-bg); color: var(--primary-blue);
            box-shadow: inset 0 0 0 1px var(--almosafer-green);
        }

        .btn-generate { 
            width: 100%; background: var(--almosafer-green); color: white; border: none; padding: 18px; 
            font-size: 18px; font-weight: 800; border-radius: 14px; cursor: pointer; transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(0, 196, 167, 0.2);
        }
        .btn-generate:hover { background: #00b096; transform: translateY(-2px); box-shadow: 0 12px 25px rgba(0, 196, 167, 0.3); }

        .internal-reminder { 
            background: #fff9e6; border: 1px solid #ffeeba; padding: 18px; border-radius: 14px; margin-top: 30px; 
            text-align: center; display: none; border-left: 6px solid #ffcc00; animation: fadeIn 0.5s;
        }
        .internal-reminder strong { color: #856404; font-size: 19px; margin-left: 10px; text-decoration: underline; }

        .output-area { margin-top: 35px; display: none; }
        .email-preview { 
            background: #ffffff; border: 2px solid #edf2f7; padding: 30px; border-radius: 16px; text-align: left; 
            direction: ltr; font-size: 16px; line-height: 1.8; border-left: 8px solid var(--almosafer-green); 
            color: #2d3748; white-space: pre-wrap; box-shadow: 0 4px 12px rgba(0,0,0,0.02);
        }
        
        .trip-table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 20px; border-radius: 12px; overflow: hidden; border: 1px solid #e2e8f0; }
        .trip-table th { background-color: var(--primary-blue); color: white; padding: 14px; font-weight: 600; }
        .trip-table td { padding: 12px; border-bottom: 1px solid #e2e8f0; text-align: center; background: white; }
        .completed-row td { background-color: #f0fff4 !important; }
        .hub-link { 
            color: #3182ce; text-decoration: none; font-size: 12px; font-weight: bold; display: inline-block; 
            background: #ebf8ff; padding: 4px 10px; border-radius: 6px; margin-top: 5px; transition: 0.2s;
        }
        .hub-link:hover { background: #bee3f8; }

        .btn-copy { 
            background: var(--primary-blue); color: white; border: none; padding: 16px; margin-top: 20px; 
            border-radius: 12px; cursor: pointer; width: 100%; font-weight: 700; font-size: 16px; transition: 0.3s;
        }
        .btn-copy:hover { background: #001a38; box-shadow: 0 5px 15px rgba(0,40,85,0.2); }

        .footer-credits { padding: 40px 20px; color: #94a3b8; font-size: 14px; text-align: center; width: 100%; background: white; border-top: 1px solid #edf2f7; }
        .footer-credits strong { color: var(--primary-blue); }

        @media (max-width: 600px) {
            .scenario-grid { grid-template-columns: 1fr; }
            .container { padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="header">
        <img src="https://i.ibb.co/SXqncGWn/images.png" alt="Almosafer Logo">
        <h1>B2B Support Smart System</h1>
    </div>

    <div class="container">
        <div class="tabs">
            <div class="tab-item active" onclick="showTab('hcn-not-section', this)">HCN Not Reflected</div>
            <div class="tab-item" onclick="showTab('followup-section', this)">Follow up Scenario</div>
            <div class="tab-item" onclick="showTab('hcn-confirmed-section', this)">HCN Confirmed</div>
            <div class="tab-item" onclick="showTab('trip-booking-section', this)">HCNs for Trip booking</div>
        </div>

        <div id="hcn-not-section" class="section active">
            <div class="form-group">
                <label>ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ (Order #):</label>
                <input type="text" id="orderIDHCNNot" placeholder="ŸÖÿ´ÿßŸÑ: 123456789">
            </div>
            <label>ÿßÿÆÿ™ÿ± ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ©:</label>
            <div class="scenario-grid">
                <label class="scenario-option"><input type="radio" name="hcnScenario" value="same_day_before"> Same day (Before)</label>
                <label class="scenario-option"><input type="radio" name="hcnScenario" value="same_day_after"> Same day (After)</label>
                <label class="scenario-option"><input type="radio" name="hcnScenario" value="before_24"> 24 Hr (Before)</label>
                <label class="scenario-option"><input type="radio" name="hcnScenario" value="more_than_48"> More than 48 Hr</label>
                <label class="scenario-option"><input type="radio" name="hcnScenario" value="makkah"> Makkah bookings</label>
            </div>
            <button class="btn-generate" onclick="processHCNNot()">Generate Email & Follow-up</button>
        </div>

        <div id="followup-section" class="section">
            <div class="form-group">
                <label>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿØÿÆŸàŸÑ (Check-in Date):</label>
                <input type="date" id="checkinFU">
            </div>
            <label>ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ©:</label>
            <div class="scenario-grid">
                <label class="scenario-option"><input type="radio" name="fuScenario" value="same_day_before"> Same Day (Before)</label>
                <label class="scenario-option"><input type="radio" name="fuScenario" value="same_day_after"> Same Day (After)</label>
                <label class="scenario-option"><input type="radio" name="fuScenario" value="within_3"> Within 3 days</label>
                <label class="scenario-option"><input type="radio" name="fuScenario" value="waiving"> Cancellation Waiving</label>
                <label class="scenario-option"><input type="radio" name="fuScenario" value="makkah"> Makkah bookings</label>
                <label class="scenario-option"><input type="radio" name="fuScenario" value="past_booking"> Past Booking</label>
                <label class="scenario-option"><input type="radio" name="fuScenario" value="future_15"> Future (+15 days)</label>
            </div>
            <button class="btn-generate" onclick="processFollowUp()">Generate Follow-up</button>
        </div>

        <div id="hcn-confirmed-section" class="section">
            <div class="form-group">
                <label>ÿ±ŸÇŸÖ ÿßŸÑÿ≠ÿ¨ÿ≤ (Order #):</label>
                <input type="text" id="orderIDConf" placeholder="e.g. 123456789">
            </div>
            <div class="form-group">
                <label>ÿ±ŸÇŸÖ ÿßŸÑÿ™ÿ£ŸÉŸäÿØ (HCN #):</label>
                <input type="text" id="hcnCode" placeholder="e.g. XYZ123">
            </div>
            <button class="btn-generate" onclick="processConfirmed()">Generate Confirmed</button>
        </div>

        <div id="trip-booking-section" class="section">
            <div class="form-group">
                <div class="trip-instruction">
                    Note: If the booking is not confirmed and has no HCN, please write:<br>
                    <strong>"Please open a separate case to get the HCN for this booking."</strong>
                </div>
                <label>Case Description</label>
                <textarea id="tripRawData" placeholder="ÿßŸÑÿµŸÇ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≠ÿ¨ÿ≤ ŸáŸÜÿß (ÿ£ÿ±ŸÇÿßŸÖ 30)..."></textarea>
            </div>
            <button class="btn-generate" onclick="processTripBooking()">Generate Table</button>
        </div>

        <div id="internal-note" class="internal-reminder">
            <span>‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá ÿßŸÑÿ≥Ÿäÿ≥ÿ™ŸÖ ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©:</span>
            <strong id="followup-display"></strong>
        </div>

        <div id="output-area" class="output-area">
            <div class="email-preview" id="finalEmail"></div>
            <button class="btn-copy" id="copyBtn" onclick="copyAction()">ŸÜÿ≥ÿÆ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ</button>
        </div>
    </div>

    <div class="footer-credits">ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÑŸÄ <strong>Hisham Mohammed Design</strong></div>

    <script>
        let currentMode = "text";

        function showTab(sectionId, element) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            element.classList.add('active');
            document.getElementById('output-area').style.display = 'none';
            document.getElementById('internal-note').style.display = 'none';
        }

        function processHCNNot() {
            currentMode = "text";
            const orderID = document.getElementById('orderIDHCNNot').value || "[Order #]";
            const scenario = document.querySelector('input[name="hcnScenario"]:checked');
            if (!scenario) return alert("Select scenario");
            
            const app = "\n\nWe greatly appreciate your continued partnership with us and looking forward to serving you in the future.\n\nShould you have any further inquiries, please do not hesitate to contact us.\n\nThanks\nB2B Team";
            let reply = ""; let fu = "";

            if (scenario.value === 'same_day_before') { reply = `Dear Partner,\n\nThank you for reaching out to us regarding order #${orderID}\n\nYour booking is confirmed under the guest name. Once the HCN is received, it will be shared with you before the check-in time.${app}`; fu = "ŸÉŸÑ 1 ÿ≥ÿßÿπÿ©"; }
            else if (scenario.value === 'same_day_after') { reply = `Dear Partner,\n\nThank you for reaching out to us regarding order #${orderID}\n\nYour booking is confirmed under the guest name. Once the HCN is received, it will be shared with you.${app}`; fu = "ŸÉŸÑ 30 ÿØŸÇŸäŸÇÿ©"; }
            else if (scenario.value === 'before_24') { reply = `Dear Partner,\n\nThank you for reaching out to us regarding order #${orderID}\n\nYour booking is confirmed under the guest name. Once the HCN is received, it will be shared within today.${app}`; fu = "ŸÉŸÑ 12 ÿ≥ÿßÿπÿ©"; }
            else if (scenario.value === 'more_than_48') { reply = `Dear Partner,\n\nThank you for reaching out to us regarding order #${orderID}\n\nYour booking is confirmed under the guest name. Once the HCN is received, it will be shared with you before 48 hours of the check-in time.${app}`; fu = "ŸÉŸÑ 48 ÿ≥ÿßÿπÿ©"; }
            else if (scenario.value === 'makkah') { reply = `Dear Partner,\n\nThank you for reaching out to us regarding order #${orderID}\n\nYour booking is confirmed under the guest name. Once the HCN is received, it will be shared with you before 24 hours of the check-in time.${app}`; fu = "ŸÉŸÑ 48 ÿ≥ÿßÿπÿ©"; }
            
            displayResults(reply, fu);
        }

        function processFollowUp() {
            currentMode = "text";
            const scenario = document.querySelector('input[name="fuScenario"]:checked');
            if (!scenario) return alert("Select scenario");
            let reply = ""; let fu = "";

            if (scenario.value === 'same_day_before') {
                reply = `Dear Partner,\n\nThank you for reaching out to us \n\nYour booking is confirmed under the guest name. Once the HCN is received, it will be shared with you before the check-in time.\n\nShould you have any further inquiries, please do not hesitate to contact us.\n\nThanks\nB2B Team`;
                fu = "ŸÉŸÑ 1 ÿ≥ÿßÿπÿ©";
            } else if (scenario.value === 'same_day_after') {
                reply = `Dear Partner,\n\nThank you for reaching out to us \n\nWe are currently following up on your request and will update you within 30 minutes of the check-in. \n\nShould you have any further inquiries, please do not hesitate to contact us.\n\nThanks\nB2B Team`;
                fu = "ŸÉŸÑ 30 ÿØŸÇŸäŸÇÿ©";
            } else if (scenario.value === 'makkah') {
                reply = `Dear Partner,\n\nThank you for reaching out to us \n\nKindly note that we are working on your request, and the reply will be shared within 24 hours.\n\nShould you have any further inquiries, please do not hesitate to contact us.\n\nThanks\nB2B Team`;
                fu = "ŸÉŸÑ 48 ÿ≥ÿßÿπÿ©";
            } else if (scenario.value === 'future_15') {
                reply = `Dear Partner,\n\nThank you for reaching out to us\n\nKindly note that we are working on your request,\nand the reply will be within within 48 to 72 hours\n\nShould you have any further inquiries, please do not hesitate to contact us.\n\nThanks\nB2B Team`;
                fu = "ŸÉŸÑ 48 ÿ≥ÿßÿπÿ©";
            } else if (scenario.value === 'waiving') {
                reply = `Dear Partner,\n\nThank you for reaching out to us\n\nKindly note that we are working on your request,\nand the reply will be within 7‚Äì14 working days\n\nShould you have any further inquiries, please do not hesitate to contact us.\n\nThanks\nB2B Team`;
                fu = "ÿ®ÿπÿØ 12 ŸäŸàŸÖ";
            } else {
                reply = `Dear Partner,\n\nThank you for reaching out to us \n\nKindly note that we are working on your request, and the reply will be shared within 48 hours.\n\nShould you have any further inquiries, please do not hesitate to contact us.\n\nThanks\nB2B Team`;
                fu = "ŸÉŸÑ 48 ÿ≥ÿßÿπÿ©";
            }
            displayResults(reply, fu);
        }

        function processConfirmed() {
            currentMode = "text";
            const order = document.getElementById('orderIDConf').value || "[Order #]";
            const hcn = document.getElementById('hcnCode').value || "[HCN]";
            const reply = `Dear Partner,\n\nThank you for reaching out to us regarding order #${order}\n\nThe booking is confirmed and paid under the hotel confirmation number #${hcn}\n\nThanks\nB2B Team`;
            displayResults(reply, "ŸÖŸÉÿ™ŸÖŸÑ ‚úÖ");
        }

        function processTripBooking() {
            currentMode = "table";
            const rawData = document.getElementById('tripRawData').value;
            const matches = rawData.match(/30-\d+/g);
            if (!matches) return alert("No 30- IDs found");
            const unique = [...new Set(matches)];
            
            let table = `<div id="email-content"><p>Dear Partner,</p><p>Thank you for reaching out to us regarding your request</p><table class="trip-table"><thead><tr><th>No.</th><th>Booking number</th><th>Confirmation Number</th></tr></thead><tbody>`;
            unique.forEach((id, i) => {
                const url = `https://hub.almosafer.com/orders/hotels?limit=20&page=1&column_name=supplier_confirmation_number&column_value=${id}`;
                table += `<tr id="row-${i}"><td>${i+1}</td><td><strong>${id}</strong><br><a href="${url}" target="_blank" class="hub-link">üîç Search Hub</a></td><td><input type="text" class="hcn-input" oninput="document.getElementById('row-${i}').classList.toggle('completed-row', this.value.trim()!=='')" placeholder="Enter HCN"></td></tr>`;
            });
            table += `</tbody></table><p><br>Best Regards,<br>B2B team</p></div>`;
            document.getElementById('finalEmail').innerHTML = table;
            document.getElementById('output-area').style.display = 'block';
            document.getElementById('internal-note').style.display = 'none';
        }

        function displayResults(reply, fu) {
            document.getElementById('finalEmail').innerText = reply;
            document.getElementById('followup-display').innerText = fu;
            document.getElementById('internal-note').style.display = 'block';
            document.getElementById('output-area').style.display = 'block';
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        function copyAction() {
            if (currentMode === "table") {
                document.querySelectorAll('.hcn-input').forEach(inp => { inp.parentElement.innerText = inp.value; });
                document.querySelectorAll('.hub-link').forEach(l => l.remove());
            }
            const el = document.getElementById('finalEmail');
            const range = document.createRange(); range.selectNode(el);
            window.getSelection().removeAllRanges(); window.getSelection().addRange(range);
            document.execCommand('copy'); alert("ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ ÿ®ŸÜÿ¨ÿßÿ≠!");
        }
    </script>
</body>
</html>